<div class="chat-page">
    <div class="message banner fixed-top" style="display: flex;">
      <div>
        <%= image_tag "seta.png", height: '32', width: '32' %>
      </div>
      <% recipient = fetch_recipient(@conversation) %>
      <h3 class="text-center"><%= recipient.first_name %></h3>
    </div>

  <% if @over_ten %>
   <%= link_to "Show Previous", "?m=all" %>
  <% end %>

  <blockquote class="messages chat-lines" id="messages">
    <% @messages.each do |message| %>
      <%= render 'message', message: message, user_is_messages_author: message.user_id == current_user.id %>
    <% end %>
  </blockquote>

  <%= form_for [@conversation, @message], html: {class: "ui reply form"}, remote: true do |f| %>
   <div class="field">
    <div class="input-group fixed-bottom">
      <%= f.text_area :body, class: 'form-control', required: true, placeholder: "Type your message..." %>
      <%= f.text_field :user_id, value: current_user.id, type: "hidden" %>
      <div class="input-group-append">
        <button class="fas  btn btn-outline-primary" type="submit"><i></i><%= image_tag "icons8-enviar-e-mail-24.png" %></button>
      </div>
    </div>
  <% end %>

  <% content_for :after_js do %>
    <script>
      App['conversation_<%= @conversation.id %>'] = App.cable.subscriptions.create({ channel: 'ConversationsChannel', conversation_id: <%= @conversation.id %>}, {
        received: (data) => {
          console.log(data);
          if (data.current_user_id !== <%= current_user.id %>) {
            const messagesContainer = document.getElementById('messages');
            messagesContainer.insertAdjacentHTML('beforeend', data.message_partial);
            scrollLastMessageIntoView();
          }
        }
      })
    </script>
  <% end %>

